<section class="page">

  <header class="toolbar">
    <form class="filters" (ngSubmit)="applyFilters()">
      <input
        type="search"
        placeholder="Buscar por nombre..."
        [(ngModel)]="qName" name="qName" />
      <select [(ngModel)]="qStatus" name="qStatus" aria-label="Filtrar por estado">
        <option value="all">Todos</option>
        <option value="Alive">Alive</option>
        <option value="Dead">Dead</option>
        <option value="unknown">Unknown</option>
      </select>
      <button class="btn" type="submit">Aplicar</button>
    </form>
  </header>

  @if (errorMsg) {
    <p class="error">{{ errorMsg }}</p>
  }

  <!-- Mostrar los personajes -->
  <div class="grid">
    @for (c of characters; track c.id) {
      <article class="card" (click)="openModal(c)" tabindex="0">
        <div class="thumb">
          <img [src]="c.image" [alt]="c.name" loading="lazy" />
          <span class="status" [attr.data-status]="c.status">{{ c.status }}</span>
          @if (isLoggedIn()) {
            <button 
              class="favorite-btn" 
              [class.is-favorite]="isFavorite(c)"
              (click)="toggleFavorite($event, c)" 
              [attr.aria-label]="isFavorite(c) ? 'Remover de favoritos' : 'A√±adir a favoritos'">
              ‚ù§
            </button>
          }
        </div>
        <div class="meta">
          <h2>{{ c.name }}</h2>
          <p class="sub">{{ c.species }} ‚Ä¢ {{ c.gender }}</p>
          <p class="loc" title="√öltima ubicaci√≥n">üìç {{ c.location?.name }}</p>
        </div>
      </article>
    }
  </div>

  <div class="actions">
    <button class="btn ghost" (click)="loadMore()" [disabled]="loading || page>=pages">
      {{ page < pages ? 'Cargar m√°s' : 'No hay m√°s resultados' }}
    </button>
  </div>

  @if (selected) {
    <div class="modal-backdrop" (click)="closeModal()"></div>
    <div class="modal" role="dialog" aria-modal="true" aria-label="Detalle de personaje">
      <button class="close" (click)="closeModal()" aria-label="Cerrar">√ó</button>
      <div class="modal-inner">
        <img class="modal-img" [src]="selected?.image" [alt]="selected?.name" />
        <div class="modal-content">
          <h3>{{ selected?.name }}</h3>
          <div class="chips">
            <span class="chip" [attr.data-status]="selected?.status">{{ selected?.status }}</span>
            <span class="chip">{{ selected?.species }}</span>
            <span class="chip">{{ selected?.gender }}</span>
          </div>
          <ul class="detail">
            <li>
              <strong>üåç Origen:</strong> 
              <span>{{ selected?.origin?.name }}</span>
            </li>
            <li>
              <strong>üìç Ubicaci√≥n:</strong> 
              <span>{{ selected?.location?.name }}</span>
            </li>
            <li>
              <strong>üì∫ Episodios:</strong> 
              <span>{{ selected?.episode?.length }} apariciones</span>
            </li>
            <li>
              <strong>üëΩ Especie:</strong> 
              <span>{{ selected?.species }}</span>
            </li>
            <li>
              <strong>‚ö• G√©nero:</strong> 
              <span>{{ selected?.gender }}</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  }
</section>
